<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motion Factory Manager</title>
    <!-- Libraries for React, Tailwind CSS, and Icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; }
        .neo-shadow { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.02); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Firebase Configuration ---
        // NOTE: In a local Notepad setup, you should replace this with your actual Firebase config object
        const firebaseConfig = {
    apiKey: "AIzaSyCbub9ifyELCi9BhOYBeOFBYSf-UZAD7-I",
    authDomain: "mf-final.firebaseapp.com",
    projectId: "mf-final",
    storageBucket: "mf-final.firebasestorage.app",
    messagingSenderId: "20592787318",
    appId: "1:20592787318:web:a10c5d7e47e7cffc304457",
    measurementId: "G-N2YRN9JFXC"
  };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'motion-factory-ledger';

        function App() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [password, setPassword] = useState('');
            const [loginError, setLoginError] = useState('');
            const [transactions, setTransactions] = useState([]);
            const [toast, setToast] = useState(null);

            const [expForm, setExpForm] = useState({ date: new Date().toISOString().split('T')[0], note: '', amtJaimin: '', amtKamal: '' });
            const [incForm, setIncForm] = useState({ date: new Date().toISOString().split('T')[0], note: '', amtJaimin: '', amtKamal: '' });

            // Auto-login if session exists
            useEffect(() => {
                if (localStorage.getItem('mf_session') === 'true') {
                    setIsAuthenticated(true);
                }
                auth.signInAnonymously().catch(console.error);
            }, []);

            // Real-time listener
            useEffect(() => {
                if (!isAuthenticated) return;
                const unsubscribe = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('ledger')
                    .onSnapshot(snapshot => {
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setTransactions(data.sort((a, b) => new Date(b.date) - new Date(a.date)));
                    });
                return () => unsubscribe();
            }, [isAuthenticated]);

            const handleLogin = (e) => {
                e.preventDefault();
                if (password === "mf-manager-2024") {
                    setIsAuthenticated(true);
                    localStorage.setItem('mf_session', 'true');
                } else {
                    setLoginError('Invalid Password');
                }
            };

            const submitEntry = async (type) => {
                const form = type === 'expense' ? expForm : incForm;
                const amtJ = parseFloat(form.amtJaimin) || 0;
                const amtK = parseFloat(form.amtKamal) || 0;

                if (!form.note || (amtJ === 0 && amtK === 0)) return;

                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('ledger').add({
                    date: form.date,
                    note: form.note,
                    amount: amtJ || amtK,
                    partner: amtJ > 0 ? 'Jaimin' : 'Kamal',
                    type: type
                });

                const reset = { date: new Date().toISOString().split('T')[0], note: '', amtJaimin: '', amtKamal: '' };
                type === 'expense' ? setExpForm(reset) : setIncForm(reset);
            };

            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-slate-900 flex items-center justify-center p-6">
                        <div className="max-w-md w-full bg-white rounded-3xl p-8 shadow-2xl">
                            <h1 className="text-2xl font-black text-center mb-6">MOTION FACTORY</h1>
                            <form onSubmit={handleLogin} className="space-y-4">
                                <input 
                                    type="password" 
                                    className="w-full border-2 p-3 rounded-xl outline-none focus:border-blue-500"
                                    placeholder="Enter Password"
                                    value={password}
                                    onChange={e => setPassword(e.target.value)}
                                />
                                {loginError && <p className="text-red-500 text-xs text-center">{loginError}</p>}
                                <button type="submit" className="w-full bg-slate-900 text-white font-bold py-3 rounded-xl">Unlock</button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="p-4 max-w-4xl mx-auto">
                    <div className="flex justify-between items-center mb-8">
                        <h1 className="text-xl font-black">MF MANAGER</h1>
                        <button onClick={() => { localStorage.removeItem('mf_session'); setIsAuthenticated(false); }} className="text-xs text-slate-400 font-bold uppercase">Logout</button>
                    </div>

                    <div className="grid gap-8">
                        {/* Simplified list for Notepad users */}
                        <div className="bg-white p-6 rounded-2xl shadow-sm border">
                            <h2 className="font-bold mb-4 text-rose-600">ADD EXPENSE</h2>
                            <div className="grid grid-cols-2 gap-2 mb-4">
                                <input type="text" placeholder="Note" className="border p-2 rounded" value={expForm.note} onChange={e => setExpForm({...expForm, note: e.target.value})} />
                                <input type="number" placeholder="Amount" className="border p-2 rounded" value={expForm.amtJaimin || expForm.amtKamal} onChange={e => setExpForm({...expForm, amtJaimin: e.target.value})} />
                            </div>
                            <button onClick={() => submitEntry('expense')} className="w-full bg-rose-600 text-white py-2 rounded-lg font-bold">Add Expense</button>
                        </div>

                        <div className="bg-white p-6 rounded-2xl shadow-sm border">
                            <h2 className="font-bold mb-4 text-slate-800">RECENT HISTORY</h2>
                            <div className="space-y-2">
                                {transactions.map(t => (
                                    <div key={t.id} className="flex justify-between border-b py-2 text-sm">
                                        <span>{t.note} ({t.partner})</span>
                                        <span className={t.type === 'income' ? 'text-emerald-600 font-bold' : 'text-rose-600 font-bold'}>â‚¹{t.amount}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
